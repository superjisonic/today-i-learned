# 3.4 모든 브로커가 다운된다면

생성일: 2021년 3월 13일 오후 4:00

> 카프카 클러스터 내 모든 브로커가 다운된다면 어떻게 대응해야할까?

![3%204%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%B3%E1%86%AB%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8F%E1%85%A5%E1%84%80%E1%85%A1%20%E1%84%83%E1%85%A1%E1%84%8B%E1%85%AE%E1%86%AB%E1%84%83%E1%85%AC%E1%86%AB%E1%84%83%E1%85%A1%E1%84%86%E1%85%A7%E1%86%AB%20755a716a13f94036bbc526b060109f30/Untitled.png](3%204%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%B3%E1%86%AB%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8F%E1%85%A5%E1%84%80%E1%85%A1%20%E1%84%83%E1%85%A1%E1%84%8B%E1%85%AE%E1%86%AB%E1%84%83%E1%85%AC%E1%86%AB%E1%84%83%E1%85%A1%E1%84%86%E1%85%A7%E1%86%AB%20755a716a13f94036bbc526b060109f30/Untitled.png)

이렇게 모든 브로커가 다운되었을때, 선택할 수 있는 사항

1. 마지막으로 리더였던 브로커가 살아나기를 기다린다
2. ISR에서 추방되었지만 먼저 살아나는 브로커가 자동으로 리더가 된다.

### 1번 방안

마지막 리더 : 메시지 ABC 모두 저장되어있음 → 재시작시 메시지 손실없이 서비스 지속제공 가능

BUT,

> 재시작시 마지막 리더가 반드시 시작되어야함

이라는 필수 조건이 존재한다.

[문제 상황]

만약 다른 브로커들은 정상화 되었지만 마지막 리더가 살아나지 않은 경우 → 전체 카프카 클러스터의 장애가 길어지게 됨

### 2번 방안

ISR에서 추방되었지만 먼저 살아나면 리더가 되는 경우, 메시지 손실이 발생함

올드 리더가 있는 브로커와 팔로워가 나중에 살아나더라도 뉴 리더와 동기화를 함

### 두개 방안 모두 장단점이 존재함 → 당신의 선택

```bash
vi /usr/local/kafka/config/server.properties
```

설정 파일을 열어서 unclean.leader.election.enable 항목을 수정

(기본값은 1번 방안으로 되어있다)

해당 항목을 true로 하면 2번방안이 된다