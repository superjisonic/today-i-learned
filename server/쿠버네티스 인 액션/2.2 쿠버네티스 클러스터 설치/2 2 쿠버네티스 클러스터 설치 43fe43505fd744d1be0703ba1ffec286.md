# 2.2 쿠버네티스 클러스터 설치

생성일: 2021년 3월 12일 오전 12:52

쿠버네티스를 먼저 설치한다

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__2.35.42.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__2.35.42.png)

Docker Desktop의 Preference에 들어가서 enable kubernetes 체크하면 손쉽게 다운된다

# 1. Minikube를 활용한 단일 노드 쿠버네티스 클러스터 실행하기

Minikube 도구: 완전하게 동작하는 쿠버네티스를 가장 간단하고 빠르게 접근하는 방법

- 로컬에서 쿠버네티스 테스트 및 개발 하는 목적으로 단일 노드 클러스터를 설치하는 도구

### Minikube 설치

[https://minikube.sigs.k8s.io/docs/start/](https://minikube.sigs.k8s.io/docs/start/) 참고..

```bash
brew install minikube
which minikube
```

쿠버네티스 클라이언트인 kubectl까지 다운된다 

### Minikube로 쿠버네티스 클러스터 시작

```bash
minikube start
```

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__2.52.04.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__2.52.04.png)

### 클러스터 작동 여부 확인 (kubectl로)

```bash
kubectl cluster-info
```

그리고 minikube ssh로 Minikube 가상머신에 로그인해서 내부를 살펴볼 수 있음

## 2. 구글 쿠버네티스 엔진을 활용한 관리형 쿠버네티스 클러스터 사용하기

GKE(관리형 구글 쿠버네티스 엔진)

- 완전한 다중 노드 쿠버네티스 클러스터를 살펴볼 수 있다
- 모든 클러스터 노드와 네트워킹을 수동으로 설정할 필요 없음
- 클러스터 잘못헐정해서 동작하거나 부분적으로 동작하는 경우 없을것..

### GCP 설정과 필요한 클라이언트 바이너리 다운

GKE 환경 설정 

[https://cloud.google.com/kubernetes-engine/docs/quickstart](https://cloud.google.com/kubernetes-engine/docs/quickstart)

프로젝트 생성후 API를 enable 시킨다

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__2.54.28.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__2.54.28.png)

빌링 활성화.. 책에서는 1년이랬는데 여기보니 90일동안만 무료란다..

### 구글클라우드 sdk 설치

[https://cloud.google.com/sdk/docs/downloads-interactive?hl=ko](https://cloud.google.com/sdk/docs/downloads-interactive?hl=ko) 참고

`curl [https://sdk.cloud.google.com](https://sdk.cloud.google.com/) | bash`

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.02.37.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.02.37.png)

`/Users/사용자이름 :` 에서엔터 한번 치면 주르륵 다운된다

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.04.06.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.04.06.png)

이미 내 정보는 다 털렸겠지만 그래도 구글에 정보주기 싫으니까 동의하지 않았다

### kubectl 명령행 도구 설치

```bash
gcloud components install kubectl
gcloud init //얘도 해줘야 zone, region 설정이 완료됨
```

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.10.26.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.10.26.png)

### 쿠버네티스 클러스터 생성

워커노드 3개를 가진 쿠버네티스 클러스터를 생성

```bash
gcloud container clusters create kubia --num-nodes 3
```

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__4.14.22.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__4.14.22.png)

## 클러스터의 개념 이해하기

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.14.03.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__3.14.03.png)

각 워커노드는 Pod안의 도커, Kublet, kube-proxy를 실행한다

- kubectl 클라이언트 명령어는 마스터 노드에서 Kubernetes API 서버로 REST 요청을 보내 클러스터와 상호작용한다

### 클러스터 노드를 조회해 클러스터 동작 상태 확인하기

```bash
kubectl get nodes
gcloud compute ssh <node-name>
```

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__4.15.13.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__4.15.13.png)

### 오브젝트 세부 정보 가져오기

```bash
kubectl describe node <node-name>
```

![2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__4.16.08.png](2%202%20%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A5%E1%84%89%E1%85%B3%E1%84%90%E1%85%A5%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8E%E1%85%B5%2043fe43505fd744d1be0703ba1ffec286/_2021-03-12__4.16.08.png)

- CPU, 메모리, 시스템 정보, 노드에 실행 중인 컨테이너 등을 포함한 노드 상태 보여줌

# 2. kubectl의 alias와 명령줄 자동완성 설정

~/.bashrc나 ~/.zshrc 에 추가하면 되지만 나는 굳이..alias 추가 안했다

```bash
alias k=kubectl
```

### kubectl 탭 완성 설정하기

bash-completion 패키지 설치 (brew install 사용)

이후

```bash
source <(kubectl completion bash)
```